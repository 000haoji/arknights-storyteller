# Android APK ç‰ˆæœ¬å·ä¿®å¤è¯´æ˜

## ğŸ› é—®é¢˜æè¿°

**ç—‡çŠ¶**ï¼š
- GitHub Release æ˜¾ç¤ºç‰ˆæœ¬ 1.10.42
- ä½†æ‰‹æœºå®‰è£…åæ˜¾ç¤ºç‰ˆæœ¬ 1.0
- æ— æ³•æ­£å¸¸å‡çº§å®‰è£…

## ğŸ” æ ¹æœ¬åŸå› 

Android APK çš„ç‰ˆæœ¬å·ç”± **`tauri.properties`** æ–‡ä»¶æ§åˆ¶ï¼Œè€Œè¿™ä¸ªæ–‡ä»¶ï¼š
1. æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ï¼ˆå¤´éƒ¨æ³¨é‡Šè¯´"DO NOT EDIT DIRECTLY"ï¼‰
2. è¢« `.gitignore` å¿½ç•¥
3. **ä½† CI/CD æ„å»ºæ—¶æ²¡æœ‰æ­£ç¡®ç”Ÿæˆ/æ›´æ–°**
4. å¯¼è‡´ä½¿ç”¨äº†æ—§çš„é»˜è®¤å€¼ï¼ˆ0.1.0 / versionCode 1000ï¼‰

### é—®é¢˜æ–‡ä»¶ä½ç½®
```
arknights-story-reader/src-tauri/gen/android/app/tauri.properties
```

### é”™è¯¯çš„å†…å®¹ï¼ˆä¿®å¤å‰ï¼‰
```properties
// THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.
tauri.android.versionName=0.1.0    âŒ åº”è¯¥æ˜¯ 1.10.42
tauri.android.versionCode=1000     âŒ åº”è¯¥æ˜¯ 11042
```

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. æ›´æ–°äº† `tauri.properties` æ–‡ä»¶
```properties
tauri.android.versionName=1.10.42  âœ…
tauri.android.versionCode=11042    âœ…
```

### 2. åœ¨ `tauri.conf.json` ä¸­æ·»åŠ äº†æ˜ç¡®çš„ versionCode
```json
"android": {
  "minSdkVersion": 24,
  "versionCode": 11042  // æ–°å¢é…ç½®
}
```

### 3. å¼ºåˆ¶å°† `tauri.properties` åŠ å…¥ç‰ˆæœ¬æ§åˆ¶
```bash
git add -f src-tauri/gen/android/app/tauri.properties
```

è™½ç„¶è¿™ä¸ªæ–‡ä»¶é€šå¸¸ä¸åº”æäº¤ï¼Œä½†ä¸ºäº†ç¡®ä¿ CI/CD æ„å»ºä½¿ç”¨æ­£ç¡®çš„ç‰ˆæœ¬å·ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶ã€‚

## ğŸ“Š ç‰ˆæœ¬å·å¯¹åº”å…³ç³»

| ç‰ˆæœ¬å· | versionName | versionCode | è®¡ç®—å…¬å¼ |
|--------|-------------|-------------|----------|
| 1.0.0  | 1.0.0       | 10000       | 1Ã—10000 + 0Ã—100 + 0 |
| 1.10.36| 1.10.36     | 11036       | 1Ã—10000 + 10Ã—100 + 36 |
| 1.10.42| 1.10.42     | 11042       | 1Ã—10000 + 10Ã—100 + 42 |
| 1.2.0  | 1.2.0       | 10200       | 1Ã—10000 + 2Ã—100 + 0 |

### versionCode è§„åˆ™
- **å¿…é¡»æ˜¯æ•´æ•°**
- **å¿…é¡»é€’å¢**ï¼ˆAndroid ç³»ç»Ÿè¦æ±‚ï¼‰
- **å»ºè®®å…¬å¼**ï¼š`ä¸»ç‰ˆæœ¬ Ã— 10000 + æ¬¡ç‰ˆæœ¬ Ã— 100 + ä¿®è®¢ç‰ˆæœ¬`

## ğŸ¯ éªŒè¯æ–¹æ³•

### æœ¬åœ°æ„å»ºéªŒè¯
```bash
cd arknights-story-reader
npm run tauri android build

# æ£€æŸ¥ç”Ÿæˆçš„ APK
# ä½ç½®: src-tauri/gen/android/app/build/outputs/apk/universal/release/
# ä½¿ç”¨ aapt æŸ¥çœ‹ç‰ˆæœ¬
aapt dump badging app-universal-release.apk | grep version
```

### å®‰è£…åéªŒè¯
```bash
# åœ¨è®¾ç½® -> åº”ç”¨ä¸­æŸ¥çœ‹
# åº”è¯¥æ˜¾ç¤ºï¼šstory-teller 1.10.42
```

## ğŸ“ ä»Šåç‰ˆæœ¬æ›´æ–°æµç¨‹

### ğŸš€ è‡ªåŠ¨åŒ–æ–¹å¼ï¼ˆæ¨èï¼‰

ç°åœ¨å·²ç»æ·»åŠ äº†è‡ªåŠ¨åŒæ­¥è„šæœ¬ï¼Œåªéœ€ä¸¤æ­¥å³å¯å®Œæˆç‰ˆæœ¬æ›´æ–°ï¼š

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ npm version å‘½ä»¤ï¼ˆæ¨èï¼‰
```bash
# è‡ªåŠ¨å‡çº§ç‰ˆæœ¬å·å¹¶åŒæ­¥æ‰€æœ‰é…ç½®
npm version patch   # 1.10.45 -> 1.10.46
npm version minor   # 1.10.45 -> 1.11.0
npm version major   # 1.10.45 -> 2.0.0

# æˆ–è€…æ‰‹åŠ¨æŒ‡å®šç‰ˆæœ¬å·
npm version 1.11.0
```
**ä¼˜ç‚¹**ï¼š
- âœ… è‡ªåŠ¨æ›´æ–° `package.json` ç‰ˆæœ¬å·
- âœ… è‡ªåŠ¨è¿è¡Œ `sync-version` è„šæœ¬åŒæ­¥æ‰€æœ‰æ–‡ä»¶
- âœ… è‡ªåŠ¨ git add æ‰€æœ‰æ›´æ”¹çš„æ–‡ä»¶
- âœ… è‡ªåŠ¨åˆ›å»º git tag

#### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨æ›´æ–°ç‰ˆæœ¬å·
```bash
# 1. æ‰‹åŠ¨ç¼–è¾‘ package.json ä¸­çš„ version å­—æ®µ
# 2. è¿è¡ŒåŒæ­¥è„šæœ¬
npm run sync-version

# 3. æäº¤æ›´æ”¹
git add .
git commit -m "chore: bump version to x.y.z"
```

### ğŸ”§ è‡ªåŠ¨åŒæ­¥è„šæœ¬è¯´æ˜

è„šæœ¬ä½ç½®ï¼š`scripts/sync-version.js`

**åŠŸèƒ½**ï¼š
- ğŸ“– ä» `package.json` è¯»å–ç‰ˆæœ¬å·ä½œä¸ºå”¯ä¸€æ•°æ®æº
- ğŸ”¢ è‡ªåŠ¨è®¡ç®— Android versionCode
- ğŸ“ åŒæ­¥æ›´æ–°ä»¥ä¸‹æ–‡ä»¶ï¼š
  1. `src-tauri/Cargo.toml`
  2. `src-tauri/tauri.conf.json`
  3. `src-tauri/gen/android/app/tauri.properties`

**æ‰‹åŠ¨è¿è¡Œ**ï¼š
```bash
npm run sync-version
```

### ğŸ“‹ æ—§æ–¹æ³•ï¼ˆä¸æ¨èï¼Œæ‰‹åŠ¨ç»´æŠ¤ï¼‰

<details>
<summary>ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ‰‹åŠ¨æ›´æ–°æ–¹æ³•</summary>

æ¯æ¬¡å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶ï¼Œéœ€è¦åŒæ­¥æ›´æ–°ä»¥ä¸‹æ–‡ä»¶ï¼š

1. **`package.json`**
   ```json
   "version": "1.10.43"
   ```

2. **`src-tauri/Cargo.toml`**
   ```toml
   version = "1.10.43"
   ```

3. **`src-tauri/tauri.conf.json`**
   ```json
   "version": "1.10.43",
   "android": {
     "versionCode": 11043
   }
   ```

4. **`src-tauri/gen/android/app/tauri.properties`**
   ```properties
   tauri.android.versionName=1.10.43
   tauri.android.versionCode=11043
   ```

</details>

## âš ï¸ é‡è¦æé†’

### versionCode å¿…é¡»é€’å¢
- âœ… 1.10.42 (versionCode 11042) â†’ 1.10.43 (versionCode 11043)
- âŒ 1.10.42 (versionCode 11042) â†’ 1.2.0 (versionCode 10200)  **é™çº§ï¼ä¼šå¯¼è‡´æ— æ³•å®‰è£…**

### å¦‚æœè¦å‘å¸ƒ 1.2.0 ç‰ˆæœ¬
éœ€è¦ç¡®ä¿ versionCode å¤§äºå½“å‰çš„ 11042ï¼Œä¾‹å¦‚ï¼š
```json
"version": "1.2.0",
"android": {
  "versionCode": 12000  // æˆ–ä»»ä½• > 11042 çš„æ•°å­—
}
```

## ğŸš€ ä¿®å¤åçš„æ•ˆæœ

- âœ… APK æ–‡ä»¶åæ˜¾ç¤ºæ­£ç¡®ç‰ˆæœ¬
- âœ… å®‰è£…ååº”ç”¨ä¿¡æ¯æ˜¾ç¤º 1.10.42
- âœ… å¯ä»¥æ­£å¸¸è¦†ç›–å®‰è£…æ—§ç‰ˆæœ¬
- âœ… Android ç³»ç»Ÿæ­£ç¡®è¯†åˆ«ä¸ºæ›´æ–°ç‰ˆæœ¬

## ğŸ”§ å·²ä¿®å¤çš„æ–‡ä»¶

### ç‰ˆæœ¬åŒæ­¥ä¿®å¤
1. âœ… `src-tauri/tauri.conf.json` - æ›´æ–° versionCode åˆ° 11045
2. âœ… `src-tauri/gen/android/app/tauri.properties` - æ›´æ–°åˆ° 1.10.45
3. âœ… æ‰€æœ‰é…ç½®æ–‡ä»¶ç‰ˆæœ¬å·å·²åŒæ­¥åˆ° 1.10.45

### è‡ªåŠ¨åŒ–å·¥å…·
4. âœ… `scripts/sync-version.js` - æ–°å¢ç‰ˆæœ¬åŒæ­¥è„šæœ¬
5. âœ… `package.json` - æ·»åŠ  `sync-version` å’Œ `version` è„šæœ¬

### æ•ˆæœ
- âœ… ç‰ˆæœ¬å·è‡ªåŠ¨åŒæ­¥ï¼Œé¿å…æ‰‹åŠ¨ç»´æŠ¤å‡ºé”™
- âœ… ä½¿ç”¨ `npm version` å³å¯ä¸€é”®æ›´æ–°æ‰€æœ‰ç‰ˆæœ¬é…ç½®
- âœ… ä¸‹ä¸€æ¬¡ CI/CD æ„å»ºçš„ APK å°†æ˜¾ç¤ºæ­£ç¡®çš„ç‰ˆæœ¬å·ï¼

---

## ğŸ“– å¿«é€Ÿå‚è€ƒ

è¯¦ç»†çš„ç‰ˆæœ¬æ›´æ–°æŒ‡å—è¯·æŸ¥çœ‹ï¼š[VERSION_UPDATE_GUIDE.md](arknights-story-reader/VERSION_UPDATE_GUIDE.md)

### æ—¥å¸¸ä½¿ç”¨ï¼ˆä¸€è¡Œå‘½ä»¤ï¼‰

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd arknights-story-reader

# æ›´æ–°ç‰ˆæœ¬ï¼ˆè‡ªåŠ¨åŒæ­¥æ‰€æœ‰é…ç½®ï¼‰
npm version patch  # æˆ– minor / major
```

å°±è¿™ä¹ˆç®€å•ï¼âœ¨
