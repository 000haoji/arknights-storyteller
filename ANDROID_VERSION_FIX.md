# Android APK ç‰ˆæœ¬å·ä¿®å¤è¯´æ˜

## ğŸ› é—®é¢˜æè¿°

**ç—‡çŠ¶**ï¼š
- GitHub Release æ˜¾ç¤ºç‰ˆæœ¬ 1.10.42
- ä½†æ‰‹æœºå®‰è£…åæ˜¾ç¤ºç‰ˆæœ¬ 1.0
- æ— æ³•æ­£å¸¸å‡çº§å®‰è£…

## ğŸ” æ ¹æœ¬åŸå› 

Android APK çš„ç‰ˆæœ¬å·ç”± **`tauri.properties`** æ–‡ä»¶æ§åˆ¶ï¼Œè€Œè¿™ä¸ªæ–‡ä»¶ï¼š
1. æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ï¼ˆå¤´éƒ¨æ³¨é‡Šè¯´"DO NOT EDIT DIRECTLY"ï¼‰
2. è¢« `.gitignore` å¿½ç•¥
3. **ä½† CI/CD æ„å»ºæ—¶æ²¡æœ‰æ­£ç¡®ç”Ÿæˆ/æ›´æ–°**
4. å¯¼è‡´ä½¿ç”¨äº†æ—§çš„é»˜è®¤å€¼ï¼ˆ0.1.0 / versionCode 1000ï¼‰

### é—®é¢˜æ–‡ä»¶ä½ç½®
```
arknights-story-reader/src-tauri/gen/android/app/tauri.properties
```

### é”™è¯¯çš„å†…å®¹ï¼ˆä¿®å¤å‰ï¼‰
```properties
// THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.
tauri.android.versionName=0.1.0    âŒ åº”è¯¥æ˜¯ 1.10.42
tauri.android.versionCode=1000     âŒ åº”è¯¥æ˜¯ 11042
```

## âœ… è§£å†³æ–¹æ¡ˆï¼ˆå½“å‰ç‰ˆæœ¬ï¼š1.11.1ï¼‰

### 1. ä»¥ `package.json` ä¸ºå”¯ä¸€æ•°æ®æº
- ä¸€åˆ‡ç‰ˆæœ¬å·éƒ½ä»¥ `package.json` çš„ `version` å­—æ®µä¸ºå‡†ï¼ˆå½“å‰ä¸º **1.11.1**ï¼‰
- Android `versionCode` é€šè¿‡è„šæœ¬æŒ‰å…¬å¼ `major * 10000 + minor * 100 + patch` è‡ªåŠ¨è®¡ç®—ï¼ˆå½“å‰ä¸º **11101**ï¼‰

### 2. ä½¿ç”¨åŒæ­¥è„šæœ¬æ›´æ–°æ‰€æœ‰é…ç½®
è¿è¡Œ `npm run sync-version`ï¼ˆæˆ–æ‰§è¡Œ `npm version patch|minor|major`ï¼Œå®ƒä¼šè‡ªåŠ¨è°ƒç”¨åŒæ­¥è„šæœ¬ï¼‰å³å¯è‡ªåŠ¨æ›´æ–°ï¼š
- `src-tauri/tauri.conf.json` â†’ `version` ä¸ `bundle.android.versionCode`
- `src-tauri/gen/android/app/tauri.properties` â†’ `versionName` ä¸ `versionCode`
- `src-tauri/Cargo.toml` â†’ `version`

> `tauri.properties` ä»ä¼šè¢«è„šæœ¬ç”Ÿæˆï¼›å¯ä»¥å°†å…¶æäº¤åˆ°ä»“åº“ï¼Œä½†è¯·å‹¿æ‰‹åŠ¨ç¼–è¾‘ã€‚

### 3. æ„å»ºå‰åŠ¡å¿…æ‰§è¡ŒåŒæ­¥
æœ¬åœ°æˆ– CI/CD åœ¨æ„å»ºå‰å»ºè®®éµå¾ªï¼š
```bash
npm install
npm run sync-version   # æˆ–æ‰§è¡Œ npm version ...
npm run tauri android build
```

å¦‚åœ¨ CI æµæ°´çº¿ï¼Œè¯·åœ¨ Tauri æ„å»ºæ­¥éª¤å‰æ–°å¢ `npm run sync-version`ï¼Œé¿å…ç‰ˆæœ¬å·å›é€€ã€‚

## ğŸ“Š ç‰ˆæœ¬å·å¯¹åº”å…³ç³»

| ç‰ˆæœ¬å· | versionName | versionCode | è®¡ç®—å…¬å¼ |
|--------|-------------|-------------|----------|
| 1.0.0  | 1.0.0       | 10000       | 1Ã—10000 + 0Ã—100 + 0 |
| 1.10.36| 1.10.36     | 11036       | 1Ã—10000 + 10Ã—100 + 36 |
| 1.10.42| 1.10.42     | 11042       | 1Ã—10000 + 10Ã—100 + 42 |
| 1.11.1 | 1.11.1      | 11101       | 1Ã—10000 + 11Ã—100 + 1 |
| 1.2.0  | 1.2.0       | 10200       | 1Ã—10000 + 2Ã—100 + 0 |

### versionCode è§„åˆ™
- **å¿…é¡»æ˜¯æ•´æ•°**
- **å¿…é¡»é€’å¢**ï¼ˆAndroid ç³»ç»Ÿè¦æ±‚ï¼‰
- **å»ºè®®å…¬å¼**ï¼š`ä¸»ç‰ˆæœ¬ Ã— 10000 + æ¬¡ç‰ˆæœ¬ Ã— 100 + ä¿®è®¢ç‰ˆæœ¬`

## ğŸ¯ éªŒè¯æ–¹æ³•

### æœ¬åœ°æ„å»ºéªŒè¯
```bash
cd arknights-story-reader
npm run tauri android build

# æ£€æŸ¥ç”Ÿæˆçš„ APK
# ä½ç½®: src-tauri/gen/android/app/build/outputs/apk/universal/release/
# ä½¿ç”¨ aapt æŸ¥çœ‹ç‰ˆæœ¬
aapt dump badging app-universal-release.apk | grep version
```

### å®‰è£…åéªŒè¯
```bash
# åœ¨è®¾ç½® -> åº”ç”¨ä¸­æŸ¥çœ‹
# åº”è¯¥æ˜¾ç¤ºï¼šstory-teller 1.11.1
```

## ğŸ“ ä»Šåç‰ˆæœ¬æ›´æ–°æµç¨‹

### ğŸš€ è‡ªåŠ¨åŒ–æ–¹å¼ï¼ˆæ¨èï¼‰

ç°åœ¨å·²ç»æ·»åŠ äº†è‡ªåŠ¨åŒæ­¥è„šæœ¬ï¼Œåªéœ€ä¸¤æ­¥å³å¯å®Œæˆç‰ˆæœ¬æ›´æ–°ï¼š

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ npm version å‘½ä»¤ï¼ˆæ¨èï¼‰
```bash
# è‡ªåŠ¨å‡çº§ç‰ˆæœ¬å·å¹¶åŒæ­¥æ‰€æœ‰é…ç½®
npm version patch   # 1.11.1 -> 1.11.2
npm version minor   # 1.11.1 -> 1.12.0
npm version major   # 1.11.1 -> 2.0.0

# æˆ–è€…æ‰‹åŠ¨æŒ‡å®šç‰ˆæœ¬å·
npm version 1.11.5
```
**ä¼˜ç‚¹**ï¼š
- âœ… è‡ªåŠ¨æ›´æ–° `package.json` ç‰ˆæœ¬å·
- âœ… è‡ªåŠ¨è¿è¡Œ `sync-version` è„šæœ¬åŒæ­¥æ‰€æœ‰æ–‡ä»¶
- âœ… è‡ªåŠ¨ git add æ‰€æœ‰æ›´æ”¹çš„æ–‡ä»¶
- âœ… è‡ªåŠ¨åˆ›å»º git tag

#### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨æ›´æ–°ç‰ˆæœ¬å·
```bash
# 1. æ‰‹åŠ¨ç¼–è¾‘ package.json ä¸­çš„ version å­—æ®µ
# 2. è¿è¡ŒåŒæ­¥è„šæœ¬
npm run sync-version

# 3. æäº¤æ›´æ”¹
git add .
git commit -m "chore: bump version to x.y.z"
```

### ğŸ”§ è‡ªåŠ¨åŒæ­¥è„šæœ¬è¯´æ˜

è„šæœ¬ä½ç½®ï¼š`scripts/sync-version.js`

**åŠŸèƒ½**ï¼š
- ğŸ“– ä» `package.json` è¯»å–ç‰ˆæœ¬å·ä½œä¸ºå”¯ä¸€æ•°æ®æº
- ğŸ”¢ è‡ªåŠ¨è®¡ç®— Android versionCode
- ğŸ“ åŒæ­¥æ›´æ–°ä»¥ä¸‹æ–‡ä»¶ï¼š
  1. `src-tauri/Cargo.toml`
  2. `src-tauri/tauri.conf.json`
  3. `src-tauri/gen/android/app/tauri.properties`

**æ‰‹åŠ¨è¿è¡Œ**ï¼š
```bash
npm run sync-version
```

### ğŸ“‹ æ—§æ–¹æ³•ï¼ˆä¸æ¨èï¼Œæ‰‹åŠ¨ç»´æŠ¤ï¼‰

<details>
<summary>ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ‰‹åŠ¨æ›´æ–°æ–¹æ³•</summary>

æ¯æ¬¡å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶ï¼Œéœ€è¦åŒæ­¥æ›´æ–°ä»¥ä¸‹æ–‡ä»¶ï¼š

1. **`package.json`**
   ```json
   "version": "x.y.z"
   ```

2. **`src-tauri/Cargo.toml`**
   ```toml
   version = "x.y.z"
   ```

3. **`src-tauri/tauri.conf.json`**
   ```json
   "version": "x.y.z",
   "android": {
     "versionCode": <æŒ‰å…¬å¼è®¡ç®—çš„æ•´æ•°>
   }
   ```

4. **`src-tauri/gen/android/app/tauri.properties`**
   ```properties
   tauri.android.versionName=x.y.z
   tauri.android.versionCode=<æŒ‰å…¬å¼è®¡ç®—çš„æ•´æ•°>
   ```

</details>

## âš ï¸ é‡è¦æé†’

### versionCode å¿…é¡»é€’å¢
- âœ… 1.11.1 (versionCode 11101) â†’ 1.11.2 (versionCode 11102)
- âŒ 1.11.1 (versionCode 11101) â†’ 1.2.0 (versionCode 10200)  **é™çº§ï¼ä¼šå¯¼è‡´æ— æ³•å®‰è£…**

### å¦‚æœè¦å‘å¸ƒ 1.2.0 ç‰ˆæœ¬
éœ€è¦ç¡®ä¿ versionCode å¤§äºå½“å‰çš„ 11042ï¼Œä¾‹å¦‚ï¼š
```json
"version": "1.2.0",
"android": {
  "versionCode": 12000  // æˆ–ä»»ä½• > 11042 çš„æ•°å­—
}
```

## ğŸš€ ä¿®å¤åçš„æ•ˆæœ

- âœ… APK æ–‡ä»¶åæ˜¾ç¤ºæ­£ç¡®ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ï¼š1.11.1ï¼‰
- âœ… å®‰è£…ååº”ç”¨ä¿¡æ¯æ˜¾ç¤º 1.11.1
- âœ… å¯ä»¥æ­£å¸¸è¦†ç›–å®‰è£…æ—§ç‰ˆæœ¬
- âœ… Android ç³»ç»Ÿæ­£ç¡®è¯†åˆ«ä¸ºæ›´æ–°ç‰ˆæœ¬

## ğŸ”§ å·²ä¿®å¤çš„æ–‡ä»¶

### ç‰ˆæœ¬åŒæ­¥ä¿®å¤
1. âœ… `src-tauri/tauri.conf.json` - å½“å‰ versionCodeï¼š**11101**
2. âœ… `src-tauri/gen/android/app/tauri.properties` - å½“å‰ç‰ˆæœ¬ï¼š**1.11.1**
3. âœ… æ‰€æœ‰é…ç½®æ–‡ä»¶ç‰ˆæœ¬å·å·²åŒæ­¥åˆ° **1.11.1**