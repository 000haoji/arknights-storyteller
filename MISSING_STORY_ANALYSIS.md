# 明日方舟剧情阅读器 - 遗漏文本全面分析报告

## 📋 总体统计

### story/ 目录结构
```
story/
├── [uc]info/       1796 txt文件 (剧情简介)
├── activities/     1721 txt文件 ✅ 已解析（活动剧情）
└── obt/            1441 txt文件
    ├── guide/        111 txt文件 ⚠️ 未解析（新手引导）
    ├── legion/         1 txt文件 ⚠️ 未解析（保全派驻说明）
    ├── main/         407 txt文件 ✅ 已解析（主线剧情）
    ├── memory/       346 txt文件 ✅ 已解析（干员密录）
    ├── record/        35 txt文件 ❌ **遗漏！主线笔记**
    ├── rogue/        181 txt文件 ✅ 已修复（肉鸽月度聊天等）
    ├── roguelike/     37 txt文件 ✅ 已解析（肉鸽关卡）
    ├── rune/           2 txt文件 ❌ **遗漏！危机合约剧情**
    ├── sandboxperm/   81 txt文件 ⚠️ 未解析（生息演算教程）
    └── tutorial/     240 txt文件 ⚠️ 未解析（训练关卡）
        ├── level/    113 txt (关卡内教程)
        └── training/ 127 txt (训练说明)
```

## 🎯 当前解析覆盖情况

### ✅ 已解析的数据源

| 目录 | 文件数 | 数据源 | 分类 |
|------|--------|--------|------|
| `activities/*` | 1721 | `story_review_table.json` | 活动剧情 |
| `obt/main/*` | 407 | `story_review_table.json` | 主线剧情 |
| `obt/memory/*` | 346 | `story_review_table.json` | 干员密录 |
| `obt/roguelike/ro*` | 37 | `story_table.json` | 肉鸽关卡 |
| `obt/rogue/*` | 181 | `roguelike_topic_table.json` | 肉鸽月度/终章（✅已修复）|

**已覆盖：2692个文件**

### ❌ 完全遗漏的重要剧情

#### 1. **obt/record/** (35个文件) 🔴 高优先级
**类型**：主线章节笔记/日志  
**内容示例**（`text_main_10_note_1.txt`）：
```
有新的客人被邀请进城了，但似乎不肯入席任何一场宴会。
上个月萨迪恩区的大规模暴力事件发生时，卡特尔向我们抱怨...
```

**分析**：
- ✅ 包含丰富的世界观和剧情信息
- ✅ 与主线章节直接关联
- ❌ 不在任何配置表中引用
- **建议**：应该添加到应用中作为"主线笔记"分类

**文件结构**：
```
record/
├── main_10/ (8个文件)
├── main_11/ (9个文件)
├── main_12/ (9个文件)
└── main_13/ (9个文件)
```

#### 2. **obt/rune/** (2个文件) 🔴 中优先级
**类型**：危机合约系统剧情介绍  
**文件**：
- `ui_rune_overall_cc.txt` - 危机合约世界观剧情
- `rune_season_0_1/` - 符文赛季说明

**内容示例**（`ui_rune_overall_cc.txt`）：
```
[HEADER] 危机合约
——天灾。
——不知从什么时候开始，天灾开始越发频繁，让大地支离破碎。
人们躲藏在前人的智慧之中，用混凝土与金属建起躲避天灾的巢穴，称之为移动城邦。
但天灾依旧无情地捕猎着地面上的一切生灵，创造着远胜灾难本身的苦难。
必须有人阻止灾难扩散，必须想办法从互相仇视、互相倾轧的城邦之间取得平衡——
```

**分析**：
- ✅ 包含重要的世界观设定
- ✅ 危机合约玩法的背景故事
- **建议**：应该添加到应用中，可归入"活动"或单独"危机合约"分类

### ⚠️ 次要内容（建议性添加）

#### 3. **obt/sandboxperm/** (81个文件)
**类型**：生息演算教程和引导  
**内容**：包含沙盒玩法的教程对话和触发剧情

**文件示例**：
- `sandbox_1/sandbox_1_training_*.txt` - 教程剧情
- `sandbox_1/trig_guide_*.txt` - 触发引导

**建议**：如果想提供完整体验，可以添加为"生息演算"分类

#### 4. **obt/tutorial/level/** (113个文件)
**类型**：主线关卡内教程对话  
**内容示例**（`main_00-01.txt`）：
```
[PopupDialog(dialogHead="$avatar_doberm")] 敌人从右边组织了进攻，请小心。
```

**分析**：
- 多为简短的战斗提示
- 与主线剧情关联但内容较简单
- **建议**：优先级较低，可作为"关卡教程"添加

#### 5. **obt/guide/** (111个文件)
**类型**：新手引导和系统介绍  
**内容**：建筑、招募、基建等系统的引导文本

**建议**：优先级最低，主要是功能说明而非剧情

#### 6. **obt/legion/** (1个文件)
**类型**：保全派驻系统说明  
**文件**：`system_legion_01.txt`

## 🔧 修复建议

### 优先级1：必须添加

1. **obt/record/** - 主线笔记（35个文件）
   - 需要直接扫描文件系统
   - 按 main_XX 分组
   - 添加到主线剧情相关分类

2. **obt/rune/** - 危机合约剧情（2个文件）
   - 直接扫描文件系统
   - 单独分类或归入活动

### 优先级2：建议添加

3. **obt/sandboxperm/** - 生息演算（81个文件）
   - 扫描 sandbox_X 目录
   - 归入活动分类

### 优先级3：可选添加

4. **obt/tutorial/level/** - 关卡教程（113个文件）
5. **obt/tutorial/training/** - 训练说明（127个文件）
6. **obt/guide/** - 系统引导（111个文件）

## 💡 实现方案

### 方案A：直接文件系统扫描（推荐）

为遗漏的目录创建专门的扫描函数：

```rust
pub fn get_record_stories_grouped(&self) -> Result<Vec<(String, Vec<StoryEntry>)>, String> {
    // 扫描 obt/record/main_XX/ 目录
    // 按章节分组
}

pub fn get_rune_stories(&self) -> Result<Vec<StoryEntry>, String> {
    // 扫描 obt/rune/ 目录
}
```

### 方案B：检查其他配置表

可能存在其他配置表引用这些文件，需要进一步调查：
- `handbook_info_table.json`
- `stage_table.json`
- `zone_table.json`

## 📈 添加后的覆盖率

| 类别 | 当前 | 添加后 |
|------|------|--------|
| 已覆盖文件 | 2692 | 2810+ |
| 覆盖率 | ~55% | ~58%+ |
| 遗漏的重要剧情 | 37个 | 0个 |

## 🎯 结论

**核心问题**：
1. ❌ **obt/record/** (35个文件）完全遗漏 - 包含重要主线笔记
2. ❌ **obt/rune/** (2个文件）完全遗漏 - 包含危机合约世界观

**优先修复**：
- 这37个文件应该立即添加，它们包含玩家关心的剧情内容

**次要内容**：
- tutorial, guide, sandboxperm 等主要是功能说明，可根据需求选择性添加

---

*生成时间：2025-10-16*  
*分析工具：AI Agent*

